<!DOCTYPE html>
    <html>
        <head>
            <meta charset="UTF-8">
            <title>Geosoftware I - Uebung 1</title>
            <script type="text/javascript" src="data/polygon.js"></script>
            <script type="text/javascript" src="data/route.js"></script>
        </head>
        <body>
            <script>

                
                //Tests
                    //Data preview
                    //console.log(polygon); //uses logitute and latitute
                    //console.log(route); //uses logitute and latitute

                    //Extract two points
                    //var pointa = route[0]
                    //var pointb = route[1]

                    //calculate distance between the two extracted points
                    //console.log(distanceBetweenTwoPoints(pointa[1], pointa[0], pointb[1], pointb[0]));

                    //Geometry test
                    var p1 = [1, 0];
                    var p2 = [1, 4];
                    var p3 = [0, 2];
                    var p4 = [4, 2];

                    var l1 = [[1, 0], [1, 4]];
                    var l2 = [[0, 2], [4, 2]];

                    var test_polygon = [[0.5, 0],[0.5, 5],[3, 5],[3, 0],[0.5, 0]];

                    //Intersection between line 1 and line 2 test
                    console.log("Intersection between line 1 and line 2 is at lon/lat: ", 
                    lineIntersection(l1[0][0], l1[0][1], l1[1][0], l1[1][1], l2[0][0], l2[0][1], l2[1][0], l2[1][1]));

                    //Point in Polygon test
                    console.log("Is p2 inside the test_polygon? ", pointInPolygon(p2, test_polygon)); //inside
                    console.log("Is p4 inside the test_polygon? ", pointInPolygon(p4, test_polygon)); //outside
                    console.log("Is p1 inside the test_polygon? ", pointInPolygon(p1, test_polygon)); //on border


                function pointLIsteToPointArray (pointList) {
                    pointArray = Array.of(pointList);
                    return pointArray;
                }

                function distanceBetweenTwoPoints(lat1, lon1, lat2, lon2) {
                    var p = 0.017453292519943295;    // Math.PI/180
                    var c = Math.cos;
                    var a = 0.5 - c((lat2 - lat1) * p)/2 + c(lat1 * p) * c(lat2 * p) * (1 - c((lon2 - lon1) * p))/2;

                    return (12742 * Math.asin(Math.sqrt(a))) * 1000; // 2 * R; R = 6371 km !!Must be changenged to conform to WGS-84
                }

                function degToRad(deg) {
                    return deg * (Math.PI/180);
                }

                function pointInPolygon(point, polygon) {
                    // ray-casting algorithm based on
                    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html

                    var x = point[0], y = point[1];

                    var inside = false;
                    for (var i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
                        var xi = polygon[i][0], yi = polygon[i][1];
                        var xj = polygon[j][0], yj = polygon[j][1];

                        var intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);

                        if (intersect) inside = !inside;
                    }
                    return inside;
                };

                function lineIntersection(lon1, lat1, lon2, lat2, lon3, lat3, lon4, lat4) { 
                    //line 1 is defined by lat1, lon1 and lat2, lon2
                    //line 1 is defined by lat3, lon3 and lat4, lon4

                    var d = (lon1 - lon2) * (lat3 - lat4) - (lat1 - lat2) * (lon3 - lon4);

                    var intersectLon = ((lon1 * lat2 - lat1*lon2) * (lon3 - lon4) - (lon1 - lon2) * (lon3 * lat4 - lat3 * lon4)) / d;
                    var intersectLat = ((lon1 * lat2 - lat1 * lon2) * (lat3 - lat4) - (lat1 - lat2) * (lon3 * lat4 - lat3 * lon4)) / d;

                    return [intersectLon, intersectLat]
                }
            </script>
        </body>
</html> 